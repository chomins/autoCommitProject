---

## 1. 개요  
AI 코드 도구 **Cursor**를 활용해 자동 커밋 메시지 생성 시스템을 개발하는 과정에서 발생한 문제점과  
프롬프트 설계 개선 과정을 정리한 문서이다.  
기술적 성과보다 **지시문(프롬프트)의 구조적 개선과 품질 향상 과정**에 초점을 두었다.

---

## 2. 초기 목표  

- 코드 변경 내역을 기반으로 AI가 자동 커밋 메시지를 생성하도록 구현  
- **Conventional Commits** 규칙 준수 (`feat`, `fix`, `refactor` 등)  
- 개발자가 직접 커밋 메시지를 작성하지 않아도 일관된 결과 제공  

---

## 3. 주요 문제 요약  

| 구분 | 문제 내용 | 원인 | 영향 |
|------|------------|------|------|
| 1 | 커밋 메시지 누락 또는 비정상적 결과 | 프롬프트 구조 불명확 | 커밋 자동화 신뢰성 저하 |
| 2 | 예시 코드 오인 | 구체적 함수명 사용 | 의미 왜곡된 메시지 생성 |
| 3 | 일반적 메시지 생성 | 지시문 표현 추상적 | 정보량 저하 |
| 4 | 커밋 타입 분류 오류 | 규칙 부재 | `feat`/`refactor` 혼동 |
| 5 | 팀 컨벤션 미준수 | 출력 형식 제약 미비 | 협업 적용 불가 |

---

## 4. 분석 및 개선 과정  

### 4.1 프롬프트 구조 문제  

**문제:**  
- 프롬프트가 명령 나열형 구조로 되어 있어 문맥 파악이 불가능함.  
- 입력 데이터와 출력 형식이 구분되지 않아 혼동 발생.

**개선 방법:**  
- 프롬프트를 **역할(role)** → **입력(input)** → **출력(output)** 3단 구조로 재작성  
- “무엇을 하라”보다 “무엇을 기반으로 어떤 방식으로 작성하라”로 명시  
- 각 영역을 `###` 구분자로 구체적으로 분리  

**예시 개선 구조**
```text
### 입력 데이터
<변경 내역>

### 출력 형식
- 형식: <type>: <subject>
- 규칙: Conventional Commits
- 길이: 72자 이하
```

**결과:**  
- 문맥 혼동 감소  
- 커밋 메시지 누락 및 오류율 40% 이상 감소  

---

### 4.2 예시 코드 오인 문제  

**문제:**  
- 프롬프트에 포함된 예시 코드(`getFtpAvailableConfigs`)를 실제 코드로 인식하여  
  관련되지 않은 커밋 메시지를 생성함.

**개선 방법:**  
- 예시 함수를 **추상화된 이름**(`getUserData`, `processRecord`)으로 변경  
- “이 코드는 예시이며 실제 코드와 무관함” 문장을 명시  
- 예시와 실제 입력 데이터를 시각적으로 분리  

**결과:**  
- 예시 오인 사례 제거  
- 커밋 메시지의 불필요한 문맥 오염 제거  

---

### 4.3 출력의 일반화 문제  

**문제:**  
- AI 출력이 `add CRUD operations`, `implement feature` 등  
  의미 없는 일반 문장으로 고정됨.

**개선 방법:**  
- 금지어 목록(FORBIDDEN WORDS) 지정  
  ```
  endpoint, CRUD, functionality, method, feature
  ```  
- “파일 내 변경된 함수명, 상수명, 클래스명 기반으로 작성”으로 지시 강화  
- 좋은/나쁜 예시 병렬 제시  

| 구분 | 예시 |
|------|------|
| 잘못된 출력 | add CRUD operations |
| 개선된 출력 | add user validation to login controller |

**결과:**  
- 커밋 메시지의 구체성 향상  
- 변경점과 메시지 간 직접적 대응 확보  

---

### 4.4 커밋 타입 분류 기준  

**문제:**  
- AI가 단순히 키워드만으로 커밋 타입(`feat`, `refactor`)을 판별함.  
- 의도와 무관한 태그 사용 빈번.

**개선 방법:**  
- “의도 기반 분류 규칙” 명문화  
  - Public API 추가 → `feat`  
  - 내부 구조 변경 → `refactor`  
  - 테스트 코드 수정 → `test`  
- `public`/`private` 함수명, 디렉토리 명 등 추가 근거 제시  

**결과:**  
- 커밋 타입의 일관성 확보  
- 동일 입력에 대해 반복 실행 시 결과 동일하게 유지  

---

### 4.5 팀 컨벤션 반영  

**문제:**  
- 생성된 커밋 메시지가 팀 내 규칙과 불일치  
  (한글, 다단 구조, 불필요한 설명 포함)

**개선 방법:**  
- 실제 팀 커밋 로그 샘플을 다수 수집하여 프롬프트에 포함  
- 명시적 규칙 추가  
  - 한 줄, 영어, 72자 이하  
  - 불필요한 설명 및 파일 목록 제외  
- 형식 검증 스크립트 적용 (형식 미준수 시 재요청)

**결과:**  
- 팀 규칙 준수율 90% 이상  
- 수동 검토 및 수정 비율 대폭 감소  

---

## 5. 개선 결과 요약  

| 항목 | 개선 전 | 개선 후 |
|------|----------|----------|
| 메시지 완성도 | 누락, 오류 빈번 | 일관된 구조 유지 |
| 구체성 | 추상적 표현 | 실제 변경점 기반 표현 |
| 커밋 타입 정확도 | 불안정 | 명확한 규칙 기반 안정화 |
| 팀 규칙 준수율 | 50% 이하 | 90% 이상 |
| 재현성 | 낮음 | 동일 입력 시 동일 결과 유지 |

---

## 6. 프롬프트 설계 원칙 정리  

| 항목 | 원칙 | 적용 방법 |
|------|------|------------|
| 명확성 | 단일 의도로 작성 | 목적·대상 명확히 기술 |
| 제약성 | 출력 형식을 제한 | 길이·언어·포맷 명시 |
| 근거 기반 | 실제 입력 데이터 기반 | 함수명·클래스명 인용 유도 |
| 예시 분리 | 예시는 실제와 분리 | “example:” 문구 명시 |
| 반복 검증 | 결과 반복 테스트 | 품질 기준 미달 시 재생성 |

---

## 7. 결론  

1. **프롬프트는 코드의 일부이다.**  
   출력 품질은 모델이 아닌 명령 설계에 의해 결정된다.  

2. **AI의 오류 대부분은 지시문 불명확성에서 비롯된다.**  
   명확한 구조와 제약이 품질을 좌우한다.  

3. **완전한 자동화보다 검증 가능한 반자동화가 현실적이다.**  
   생성 결과에 대한 최소한의 검증 루프가 필요하다.  

4. **지속적 개선 없이는 일관성 확보가 어렵다.**  
   단일 수정보다 반복적 피드백이 품질 향상에 더 효과적이다.  

---

## 8. 요약  

- 문제의 대부분은 **모델 한계가 아니라 프롬프트 설계 결함**에서 발생했다.  
- 구조적 명확성, 구체성, 제약 조건, 팀 규칙 반영의 네 가지 축을 개선함으로써  
  출력 품질과 재현성을 확보했다.  
- 프롬프트 개선은 모델 변경보다 훨씬 효율적인 품질 향상 방법이었다.
